USER root
ENV DEBIAN_FRONTEND=noninteractive

RUN apt update && \
    wget -q -O /tmp/lrose.deb https://github.com/NCAR/lrose-core/releases/download/lrose-core-20250811/lrose-core-20250811.ubuntu_24.04.amd64.deb && \
    dpkg-deb -x /tmp/lrose.deb / && \
    apt-get -y install nodejs && \
    apt-get clean && \
    rm -rf /tmp/lrose.deb

USER ${NB_USER}
RUN CONDA_DIR=/srv/conda && \
    RADARENV=notebook && \
    CONDA_PREFIX=$CONDA_DIR/envs/$RADARENV && \
    export PROJ_NETWORK=ON && \
    export BALTRAD_INSTALL_ROOT=${PWD} && \
    echo "export CONDA_DIR=$CONDA_DIR" >> ~/.profile && \
    echo "export RADARENV=$RADARENV" >> ~/.profile && \
    echo "export CONDA_PREFIX=$CONDA_PREFIX" >> ~/.profile && \
    echo "export PROJ_NETWORK=$PROJ_NETWORK" >> ~/.profile && \
    ${CONDA_PREFIX}/bin/bash -l $BALTRAD_INSTALL_ROOT/install/baltrad/install_baltrad.sh && \
    rm -rf $BALTRAD_INSTALL_ROOT/install && \
    ${MAMBA_EXE} clean --all -f -y && \
    cp binder/kernel.json $CONDA_PREFIX/share/jupyter/kernels/python3/.
